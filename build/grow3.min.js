// grow3.js
'use strict';var grow3=grow3||{};
grow3.State=function(){var e=new THREE.MeshPhongMaterial({color:13421772}),a=function(a){this.objectProto=new THREE.Object3D;this.objectProto.matrixAutoUpdate=!1;this.txt="";this.textParamId=void 0;void 0===a?(this.mat=e,this.textParam={size:1,height:0.3,curveSegments:2,font:"helvetiker"}):(this.mat=a.mat,this.textParam=a.textParam)};a.prototype.constructor=a;a.prototype.clone=function(){var a=new grow3.State(this,this.sys);this.objectProto.clone(a.objectProto);return a};return a}();
grow3.System=function(){var e=new THREE.CubeGeometry(1,1,1),a=function(b,a,c){this.scene=b;this.script=a;this.backlog=[];this.backlogBuild=[];this.mDepth=20;this.depth=0;this.state=this.rollback=new grow3.State(void 0);this.state.objectProto.matrixAutoUpdate=!0;this.parent=new grow3.State(void 0);this.parent.objectProto=b;this.scene.add(this.state.objectProto);this.cameraObj=c;this.backgroundColor=13421772};a.prototype.constructor=a;a.prototype.toString=function(){return"[grow3.System]"};a.prototype.maxDepth=
function(b){this.mDepth=b};a.prototype.rule=function(b){var a=function(c){!0===c?(this.parent=this.state,this.rollback=new grow3.State(this.state),this.state=this.rollback.clone(),"function"===typeof b?b.call(this):(c=Math.floor(Math.random()*b.length),b[c].call(this))):this.depth<this.mDepth&&(this.backlogBuild.push([a,this.state]),this.parent.objectProto.add(this.state.objectProto),this.state=this.rollback.clone());return this};return a};a.prototype.rules=function(b){for(var a in b)this[a]=this.rule(b[a])};
a.prototype.trigger=function(b){void 0!==this.script&&this.script.call(this,this);b=b||"start";this.scene.add(this.state.objectProto);this.depth=0;this.backlogBuild.push([this[b],this.state]);do{this.depth++;this.backlog=this.backlogBuild;for(this.backlogBuild=[];0<this.backlog.length;)b=this.backlog.shift(),this.state=b[1],b[0].call(this,!0)}while(0<this.backlogBuild.length)};a.prototype.rnd=function(b,a){var c=Math.random();if(Array.isArray(b))return b[Math.floor(c*b.length)];void 0!==b&&(c=void 0!==
a?c*(a-b)+b:2*c*b-b);return c};a.prototype.select=function(b,a){var c=b.length,d=a%c;return b[0>d?d+c:d]};a.prototype.background=function(b){this.backgroundColor=b};var d=a.prototype.rule;a.prototype.cube=d(function(){var b=new THREE.Mesh(e,this.state.mat);this.parent.objectProto.clone(b);this.parent.objectProto.parent.add(b)});var f={};a.prototype.glyphs=d(function(){var b=this.parent.textParam;void 0===this.parent.textParamId&&(this.parent.textParamId=b.font+":"+b.size+":"+b.height+":"+b.curveSegments,
f[this.parent.textParamId]=f[this.parent.textParamId]||{});if(" "!==this.parent.txt){if(!f[this.parent.textParamId].hasOwnProperty(this.parent.txt)){b=new THREE.TextGeometry(this.parent.txt,this.parent.textParam);b.computeBoundingBox();var a=b.boundingBox,a=-0.5*(a.min.x+a.max.x);b.applyMatrix((new THREE.Matrix4).makeTranslation(a,0,0));b.computeBoundingBox();f[this.parent.textParamId][this.parent.txt]=b}b=new THREE.Mesh(f[this.parent.textParamId][this.parent.txt],this.parent.mat);this.parent.objectProto.clone(b);
this.parent.objectProto.parent.add(b)}});a.prototype.camera=d(function(){void 0!==this.cameraObj&&(void 0!==this.cameraObj.parent&&this.cameraObj.parent.remove(this.cameraObj),this.parent.objectProto.clone(this.cameraObj),this.cameraObj.lookAt(0),this.cameraObj.matrixAutoUpdate=!0,this.scene.add(this.cameraObj))});var d=function(b){return function(a){Array.isArray(a)?(void 0===a.startDepth&&(a.startDepth=this.depth),b.call(this,a[(this.depth-a.startDepth)%a.length])):b.call(this,a);return this}},
c=new THREE.Matrix4;a.prototype.move=d(function(b){c.makeTranslation(b,0,0);this.state.objectProto.matrix.multiplyMatrices(c,this.state.objectProto.matrix)});a.prototype.m=a.prototype.move;a.prototype.transHoriz=d(function(b){c.makeTranslation(0,b,0);this.state.objectProto.matrix.multiplyMatrices(c,this.state.objectProto.matrix)});a.prototype.tH=a.prototype.transHoriz;a.prototype.transVert=d(function(b){c.makeTranslation(0,0,b);this.state.objectProto.matrix.multiplyMatrices(c,this.state.objectProto.matrix)});
a.prototype.tV=a.prototype.transVert;a.prototype.scale=d(function(b){c.makeScale(b,b,b);this.state.objectProto.matrix.multiplyMatrices(c,this.state.objectProto.matrix)});a.prototype.s=a.prototype.scale;a.prototype.roll=d(function(b){b=b*Math.PI/180;c.makeRotationX(b);this.state.objectProto.matrix.multiplyMatrices(c,this.state.objectProto.matrix)});a.prototype.rX=a.prototype.roll;a.prototype.yaw=d(function(b){b=b*Math.PI/180;c.makeRotationY(b);this.state.objectProto.matrix.multiplyMatrices(c,this.state.objectProto.matrix)});
a.prototype.rY=a.prototype.yaw;a.prototype.pitch=d(function(b){b=b*Math.PI/180;c.makeRotationZ(b);this.state.objectProto.matrix.multiplyMatrices(c,this.state.objectProto.matrix)});a.prototype.rZ=a.prototype.pitch;a.prototype.material=d(function(b){this.state.mat=b});a.prototype.text=d(function(b){this.state.txt=b});a.prototype.textParam=d(function(b){this.state.textParam!==b&&(this.state.textParamId=void 0);this.state.textParam=b});return a}();grow3=grow3||{};
grow3.Runner=function(){var e,a=function(a){e=this;this.isRendering=!1;var c=window.innerWidth,b=window.innerHeight,g=c/b;Detector.webgl?this.renderer=new THREE.WebGLRenderer({antialias:!0}):(a.appendChild(Detector.getWebGLErrorMessage()),this.renderer=new THREE.CanvasRenderer);this.renderer.setSize(c,b);this.container=document.createElement("div");a.appendChild(this.container);this.container.appendChild(this.renderer.domElement);this.camera=new THREE.PerspectiveCamera(45,g,0.1,2E4);THREEx.FullScreen.bindKey({charCode:102});
THREEx.WindowResize(this.renderer,this.camera);this.controls=new THREE.TrackballControls(this.camera,this.container);d()};a.prototype.run=function(a){this.isRendering=!1;this.scene=new THREE.Scene;this.scene.add(this.camera);this.camera.position.set(-25,-10,10);this.camera.lookAt(0);var c=new THREE.PointLight(16772846,1.3);c.position.set(10,10,10);this.scene.add(c);c=new THREE.PointLight(15658751,1);c.position.set(-10,-10,-10);this.scene.add(c);this.g=new grow3.System(this.scene,a,this.camera);this.g.trigger();
this.isRendering=!0};var d=function(){requestAnimationFrame(d);e.isRendering&&(e.renderer.setClearColor(e.g.backgroundColor),e.renderer.render(e.scene,e.camera),e.controls.update())};return a}();
