// grow3.js
'use strict';var grow3=grow3||{};
grow3.State=function(){var e=new THREE.MeshPhongMaterial({color:13421772}),b=function(b){this.objectProto=new THREE.Object3D;this.objectProto.matrixAutoUpdate=!1;this.txt="";this.textParamId=void 0;void 0===b?(this.mat=e,this.textParam={size:1,height:0.3,curveSegments:2,font:"helvetiker"}):(this.mat=b.mat,this.textParam=b.textParam)};b.prototype.constructor=b;b.prototype.clone=function(){var b=new grow3.State(this,this.sys);this.objectProto.clone(b.objectProto);return b};return b}();
grow3.System=function(){var e=new THREE.CubeGeometry(1,1,1),b=function(a,b,c){this.scene=a;this.script=b;this.backlog=[];this.backlogBuild=[];this.mDepth=20;this.depth=0;this.state=this.rollback=new grow3.State(void 0);this.state.objectProto.matrixAutoUpdate=!0;this.parent=new grow3.State(void 0);this.parent.objectProto=a;this.scene.add(this.state.objectProto);this.cameraObj=c;this.backgroundColor=13421772};b.prototype.constructor=b;b.prototype.toString=function(){return"[grow3.System]"};b.prototype.maxDepth=
function(a){this.mDepth=a};b.prototype.rule=function(a){var b=function(c,d){if(!0===d)if(this.parent=this.state,this.rollback=new grow3.State(this.state),this.state=this.rollback.clone(),"function"===typeof a)a.call(this);else{var e=Math.floor(Math.random()*a.length);a[e].call(this)}else this.depth<this.mDepth&&(this.backlogBuild.push([b,this.state]),this.parent.objectProto.add(this.state.objectProto),this.state=this.rollback.clone());return this};return b};b.prototype.rules=function(a){for(var b in a)this[b]=
this.rule(a[b])};b.prototype.trigger=function(a){void 0!==this.script&&this.script.call(this,this);a=a||"start";this.scene.add(this.state.objectProto);this.depth=0;this.backlogBuild.push([this[a],this.state]);do{this.depth++;this.backlog=this.backlogBuild;for(this.backlogBuild=[];0<this.backlog.length;)a=this.backlog.shift(),this.state=a[1],a[0].call(this,this,!0)}while(0<this.backlogBuild.length)};b.prototype.rnd=function(a,b){var c=Math.random();if(Array.isArray(a))return a[Math.floor(c*a.length)];
void 0!==a&&(c=void 0!==b?c*(b-a)+a:2*c*a-a);return c};b.prototype.select=function(a,b){var c=a.length,d=b%c;return a[0>d?d+c:d]};b.prototype.background=function(a){this.backgroundColor=a};var d=b.prototype.rule;b.prototype.cube=d(function(){var a=new THREE.Mesh(e,this.state.mat);this.parent.objectProto.clone(a);this.parent.objectProto.parent.add(a)});var f={};b.prototype.glyphs=d(function(){var a=this.parent.textParam;void 0===this.parent.textParamId&&(this.parent.textParamId=a.font+":"+a.size+":"+
a.height+":"+a.curveSegments,f[this.parent.textParamId]=f[this.parent.textParamId]||{});if(" "!==this.parent.txt){if(!f[this.parent.textParamId].hasOwnProperty(this.parent.txt)){a=new THREE.TextGeometry(this.parent.txt,this.parent.textParam);a.computeBoundingBox();var b=a.boundingBox,b=-0.5*(b.min.x+b.max.x);a.applyMatrix((new THREE.Matrix4).makeTranslation(b,0,0));a.computeBoundingBox();f[this.parent.textParamId][this.parent.txt]=a}a=new THREE.Mesh(f[this.parent.textParamId][this.parent.txt],this.parent.mat);
this.parent.objectProto.clone(a);this.parent.objectProto.parent.add(a)}});b.prototype.camera=d(function(){void 0!==this.cameraObj&&(void 0!==this.cameraObj.parent&&this.cameraObj.parent.remove(this.cameraObj),this.parent.objectProto.clone(this.cameraObj),this.cameraObj.lookAt(0),this.cameraObj.matrixAutoUpdate=!0,this.scene.add(this.cameraObj))});var d=function(a){return function(b){Array.isArray(b)?(void 0===b.startDepth&&(b.startDepth=this.depth),a.call(this,b[(this.depth-b.startDepth)%b.length])):
a.call(this,b);return this}},c=new THREE.Matrix4;b.prototype.move=d(function(a){c.makeTranslation(a,0,0);this.state.objectProto.matrix.multiplyMatrices(c,this.state.objectProto.matrix)});b.prototype.m=b.prototype.move;b.prototype.transHoriz=d(function(a){c.makeTranslation(0,a,0);this.state.objectProto.matrix.multiplyMatrices(c,this.state.objectProto.matrix)});b.prototype.tH=b.prototype.transHoriz;b.prototype.transVert=d(function(a){c.makeTranslation(0,0,a);this.state.objectProto.matrix.multiplyMatrices(c,
this.state.objectProto.matrix)});b.prototype.tV=b.prototype.transVert;b.prototype.scale=d(function(a){c.makeScale(a,a,a);this.state.objectProto.matrix.multiplyMatrices(c,this.state.objectProto.matrix)});b.prototype.s=b.prototype.scale;b.prototype.roll=d(function(a){a=a*Math.PI/180;c.makeRotationX(a);this.state.objectProto.matrix.multiplyMatrices(c,this.state.objectProto.matrix)});b.prototype.rX=b.prototype.roll;b.prototype.yaw=d(function(a){a=a*Math.PI/180;c.makeRotationY(a);this.state.objectProto.matrix.multiplyMatrices(c,
this.state.objectProto.matrix)});b.prototype.rY=b.prototype.yaw;b.prototype.pitch=d(function(a){a=a*Math.PI/180;c.makeRotationZ(a);this.state.objectProto.matrix.multiplyMatrices(c,this.state.objectProto.matrix)});b.prototype.rZ=b.prototype.pitch;b.prototype.material=d(function(a){this.state.mat=a});b.prototype.text=d(function(a){this.state.txt=a});b.prototype.textParam=d(function(a){this.state.textParam!==a&&(this.state.textParamId=void 0);this.state.textParam=a});return b}();grow3=grow3||{};
grow3.Runner=function(){var e,b=function(b){e=this;this.isRendering=!1;var c=window.innerWidth,a=window.innerHeight,g=c/a;this.renderer=Detector.webgl?new THREE.WebGLRenderer({antialias:!0}):new THREE.CanvasRenderer;this.renderer.setSize(c,a);this.container=document.createElement("div");b.appendChild(this.container);this.container.appendChild(this.renderer.domElement);this.camera=new THREE.PerspectiveCamera(45,g,0.1,2E4);THREEx.FullScreen.bindKey({charCode:102});THREEx.WindowResize(this.renderer,this.camera);
this.controls=new THREE.TrackballControls(this.camera,this.container);d()};b.prototype.run=function(b){this.isRendering=!1;this.scene=new THREE.Scene;this.scene.add(this.camera);this.camera.position.set(-25,-10,10);this.camera.lookAt(0);var c=new THREE.PointLight(16772846,1.3);c.position.set(10,10,10);this.scene.add(c);c=new THREE.PointLight(15658751,1);c.position.set(-10,-10,-10);this.scene.add(c);this.g=new grow3.System(this.scene,b,this.camera);this.g.trigger();this.isRendering=!0};var d=function(){requestAnimationFrame(d);
e.isRendering&&(e.renderer.setClearColor(e.g.backgroundColor),e.renderer.render(e.scene,e.camera),e.controls.update())};return b}();
