// grow3.js
'use strict';var grow3=grow3||{};grow3.State=function(){var e=new THREE.MeshPhongMaterial({color:13421772}),f=function(a){this.objectProto=new THREE.Object3D;this.objectProto.matrixAutoUpdate=!1;this.textParamId=void 0;void 0===a?(this.mat=e,this.textParam={size:1,height:0.3,curveSegments:2,font:"helvetiker"}):(this.mat=a.mat,this.textParam=a.textParam)};f.prototype.constructor=f;f.prototype.clone=function(){var a=new grow3.State(this,this.sys);this.objectProto.clone(a.objectProto);return a};return f}();
grow3.System=function(){var e=new THREE.CubeGeometry(1,1,1),f=new THREE.SphereGeometry(0.5,32,16),a=function(b,a,c){this.scene=b;this.script=c;this.backlog=[];this.backlogBuild=[];this.mDepth=20;this.depth=0;this.state=this.rollback=new grow3.State(void 0);this.state.objectProto.matrixAutoUpdate=!0;this.parent=new grow3.State(void 0);this.parent.objectProto=b;this.scene.add(this.state.objectProto);this.cameraObj=a;this.hasLighting=!1;this.backgroundColor=13421772};a.prototype.constructor=a;a.prototype.toString=
function(){return"[grow3.System]"};a.prototype.maxDepth=function(b){this.mDepth=b};a.prototype.rule=function(b){var a=function(c){var d=Array.prototype.slice.call(arguments,1);if(!0===c)if(this.parent=this.state,this.rollback=new grow3.State(this.state),this.state=this.rollback.clone(),d.forEach(function(b,a,c){Array.isArray(b)&&(c[a]=this.handleParameter(b))},this),"function"===typeof b)b.apply(this,d);else{var e=Math.floor(Math.random()*b.length);b[e].call(this,d)}else this.depth<this.mDepth&&(this.backlogBuild.push([a,
this.state,d]),this.parent.objectProto.add(this.state.objectProto),this.state=this.rollback.clone());return this};return a};a.prototype.rules=function(b){for(var a in b)this[a]=this.rule(b[a])};a.prototype.build=function(b){this.scene.add(this.state.objectProto);var a=this.state.objectProto;this.depth=0;void 0!==this.script&&this.script.call(this,this);if(void 0!==b||0===this.backlogBuild.length)this.backlogBuild.push([this[b||"start"],this.state,[]]);do{this.depth++;this.backlog=this.backlogBuild;
for(this.backlogBuild=[];0<this.backlog.length;)b=this.backlog.shift(),this.state=b[1],b[2].unshift(!0),b[0].apply(this,b[2])}while(0<this.backlogBuild.length);return a};a.prototype.rnd=function(b,a){var c=Math.random();if(Array.isArray(b))return b[Math.floor(c*b.length)];void 0!==b&&(c=void 0!==a?c*(a-b)+b:2*c*b-b);return c};a.prototype.select=function(b,a){var c=b.length,d=a%c;return b[0>d?d+c:d]};a.prototype.handleParameter=function(b){return Array.isArray(b)?(void 0===b.startDepth&&(b.startDepth=
this.depth),b[(this.depth-b.startDepth)%b.length]):b};a.prototype.background=function(b){this.backgroundColor=b};a.prototype.addMesh=function(b){b=new THREE.Mesh(b,this.state.mat);this.parent.objectProto.clone(b);this.parent.objectProto.parent.add(b)};var c=a.prototype.rule;a.prototype.mesh=c(a.prototype.addMesh);a.prototype.cube=c(function(){this.addMesh(e)});a.prototype.sphere=c(function(){this.addMesh(f)});var g={};a.prototype.glyphs=c(function(b){var a=this.parent.textParam;void 0===this.parent.textParamId&&
(this.parent.textParamId=a.font+":"+a.size+":"+a.height+":"+a.curveSegments,g[this.parent.textParamId]=g[this.parent.textParamId]||{});if(" "!==b){if(!g[this.parent.textParamId].hasOwnProperty(b)){a=new THREE.TextGeometry(b,this.parent.textParam);a.computeBoundingBox();var c=a.boundingBox,c=-0.5*(c.min.x+c.max.x);a.applyMatrix((new THREE.Matrix4).makeTranslation(c,0,0));a.computeBoundingBox();g[this.parent.textParamId][b]=a}this.addMesh(g[this.parent.textParamId][b])}});var h=new THREE.Quaternion,
k=new THREE.Vector3;a.prototype.camera=c(function(){void 0!==this.cameraObj&&(this.scene.updateMatrixWorld(!0),this.parent.objectProto.matrixWorld.decompose(this.cameraObj.position,h,k),this.cameraObj.lookAt(0))});a.prototype.light=c(function(b,a,c){b=new THREE.PointLight(b,a,c);this.parent.objectProto.clone(b);this.parent.objectProto.parent.add(b);this.hasLighting=!0});a.prototype.buildModifier=function(b){return function(a){for(var c=[],d=0;d<arguments.length;d++)c[d]=this.handleParameter(arguments[d]);
b.apply(this,c);return this}};var c=a.prototype.buildModifier,d=new THREE.Matrix4;a.prototype.move=c(function(b){d.makeTranslation(b,0,0);this.state.objectProto.matrix.multiplyMatrices(d,this.state.objectProto.matrix)});a.prototype.m=a.prototype.move;a.prototype.transHoriz=c(function(b){d.makeTranslation(0,b,0);this.state.objectProto.matrix.multiplyMatrices(d,this.state.objectProto.matrix)});a.prototype.tH=a.prototype.transHoriz;a.prototype.transVert=c(function(b){d.makeTranslation(0,0,b);this.state.objectProto.matrix.multiplyMatrices(d,
this.state.objectProto.matrix)});a.prototype.tV=a.prototype.transVert;a.prototype.scale=c(function(b,a,c){void 0!==a&&void 0!=c?d.makeScale(b,a,c):d.makeScale(b,b,b);this.state.objectProto.matrix.multiplyMatrices(d,this.state.objectProto.matrix)});a.prototype.s=a.prototype.scale;a.prototype.roll=c(function(b){b=b*Math.PI/180;d.makeRotationX(b);this.state.objectProto.matrix.multiplyMatrices(d,this.state.objectProto.matrix)});a.prototype.rX=a.prototype.roll;a.prototype.yaw=c(function(b){b=b*Math.PI/
180;d.makeRotationY(b);this.state.objectProto.matrix.multiplyMatrices(d,this.state.objectProto.matrix)});a.prototype.rY=a.prototype.yaw;a.prototype.pitch=c(function(b){b=b*Math.PI/180;d.makeRotationZ(b);this.state.objectProto.matrix.multiplyMatrices(d,this.state.objectProto.matrix)});a.prototype.rZ=a.prototype.pitch;a.prototype.material=c(function(b){this.state.mat=b});a.prototype.textParam=c(function(b){this.state.textParam!==b&&(this.state.textParamId=void 0);this.state.textParam=b});return a}();grow3=grow3||{};
grow3.Runner=function(){var e,f=function(c,f){e=this;this.isRendering=!1;this.frameCount=0;var h=window.innerWidth,k=window.innerHeight,d=h/k;Detector.webgl?this.renderer=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}):(c.appendChild(Detector.getWebGLErrorMessage()),this.renderer=new THREE.CanvasRenderer);this.renderer.setSize(h,k);this.container=document.createElement("div");c.appendChild(this.container);this.container.appendChild(this.renderer.domElement);this.camera=new THREE.PerspectiveCamera(45,
d,0.1,2E4);THREEx.FullScreen.bindKey({charCode:102});THREEx.WindowResize(this.renderer,this.camera);this.controls=new THREE.TrackballControls(this.camera,this.container);this.doScreenshot=f;a()};f.prototype.run=function(a){this.isRendering=!1;this.frameCount=0;this.scene=new THREE.Scene;this.scene.add(this.camera);this.camera.position.set(-25,-10,0);this.camera.lookAt(0);this.g=new grow3.System(this.scene,this.camera,a);this.g.build();this.g.hasLighting||(a=new THREE.PointLight(16772846,1.3),a.position.set(10,
10,10),this.scene.add(a),a=new THREE.PointLight(15658751,1),a.position.set(-10,-10,-10),this.scene.add(a));this.isRendering=!0};var a=function(){requestAnimationFrame(a);e.isRendering?(e.frameCount++,e.renderer.setClearColor(e.g.backgroundColor),e.renderer.render(e.scene,e.camera),e.controls.update()):e.frameCount=0};return f}();
